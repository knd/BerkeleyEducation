[('def', 'range', ('lambda', ['start', 'stop'], [('def', 'i', ('var', 'start')), ('exp', ('lambda', [], [('if', ('<', ('var', 'i'), ('var', 'stop')), [('def', 'cur', ('var', 'i')), ('asgn', 'i', ('+', ('var', 'i'), ('int-lit', 1))), ('exp', ('var', 'cur'))], [('exp', ('null',))])]))])), ('def', 'take_from', ('lambda', ['list', 'n'], [('def', 'res', ('dict-lit', [])), ('def', 'i', ('int-lit', 0)), ('for', 'x', ('var', 'list'), [('if', ('>=', ('var', 'i'), ('var', 'n')), [('exp', ('call', ('var', 'append'), [('var', 'res'), ('var', 'x')]))], None), ('asgn', 'i', ('+', ('var', 'i'), ('int-lit', 1)))]), ('exp', ('var', 'res'))])), ('def', 'copy', ('lambda', ['list'], [('def', 'res', ('dict-lit', [])), ('for', 'x', ('var', 'list'), [('exp', ('call', ('var', 'append'), [('var', 'res'), ('var', 'x')]))]), ('exp', ('var', 'res'))])), ('def', 'wrap', ('lambda', ['lam', 'arg'], [('def', 'co', ('coroutine', ('var', 'lam'))), ('exp', ('lambda', [], [('exp', ('resume', ('var', 'co'), ('var', 'arg')))]))])), ('def', 'isVar', ('lambda', ['t'], [('exp', ('==', ('get', ('var', 't'), ('string-lit', 'typ')), ('string-lit', 'var')))])), ('def', 'isCst', ('lambda', ['t'], [('exp', ('==', ('get', ('var', 't'), ('string-lit', 'typ')), ('string-lit', 'cst')))])), ('def', 'isClause', ('lambda', ['t'], [('exp', ('==', ('get', ('var', 't'), ('string-lit', 'typ')), ('string-lit', 'cls')))])), ('def', 'contains', ('lambda', ['term', 'var'], [('def', 'contains0', ('lambda', ['clause', 'var'], [('def', 'res', ('var', 'False')), ('for', 'term', ('var', 'clause'), [('asgn', 'res', ('||', ('var', 'res'), ('call', ('var', 'contains'), [('var', 'term'), ('var', 'var')])))]), ('exp', ('var', 'res'))])), ('if', ('call', ('var', 'isCst'), [('var', 'term')]), [('exp', ('var', 'False'))], [('if', ('call', ('var', 'isVar'), [('var', 'term')]), [('exp', ('==', ('get', ('var', 'term'), ('string-lit', 'name')), ('var', 'var')))], [('if', ('call', ('var', 'isClause'), [('var', 'term')]), [('exp', ('call', ('var', 'contains0'), [('get', ('var', 'term'), ('string-lit', 'ref')), ('var', 'var')]))], [('error', ('+', ('string-lit', 'contains: Unknown term type: '), ('get', ('var', 'term'), ('string-lit', 'typ'))))])])])])), ('def', 'subst_term', ('lambda', ['term', 'slist'], [('def', 'newterm', ('dict-lit', [('typ', ('get', ('var', 'term'), ('string-lit', 'typ')))])), ('if', ('call', ('var', 'isVar'), [('var', 'term')]), [('put', ('var', 'newterm'), ('string-lit', 'name'), ('get', ('var', 'term'), ('string-lit', 'name'))), ('for', 's', ('var', 'slist'), [('if', ('==', ('get', ('var', 's'), ('string-lit', 'from')), ('get', ('var', 'term'), ('string-lit', 'name'))), [('asgn', 'newterm', ('get', ('var', 's'), ('string-lit', 'to')))], None)])], [('if', ('call', ('var', 'isClause'), [('var', 'term')]), [('put', ('var', 'newterm'), ('string-lit', 'ref'), ('call', ('var', 'subst_clause'), [('get', ('var', 'term'), ('string-lit', 'ref')), ('var', 'slist')]))], [('if', ('call', ('var', 'isCst'), [('var', 'term')]), [('put', ('var', 'newterm'), ('string-lit', 'name'), ('get', ('var', 'term'), ('string-lit', 'name')))], [('error', ('+', ('string-lit', 'subst0: Unknown term type: '), ('get', ('var', 'term'), ('string-lit', 'typ'))))])])]), ('exp', ('var', 'newterm'))])), ('def', 'subst_clause', ('lambda', ['clause', 'slist'], [('def', 'newclause', ('dict-lit', [('name', ('get', ('var', 'clause'), ('string-lit', 'name'))), ('negated', ('get', ('var', 'clause'), ('string-lit', 'negated')))])), ('for', 'i', ('call', ('var', 'range'), [('int-lit', 0), ('len', ('var', 'clause'))]), [('put', ('var', 'newclause'), ('var', 'i'), ('call', ('var', 'subst_term'), [('get', ('var', 'clause'), ('var', 'i')), ('var', 'slist')]))]), ('exp', ('var', 'newclause'))])), ('def', 'subst', ('lambda', ['clauses', 'slist'], [('def', 'newclist', ('dict-lit', [])), ('for', 'c', ('var', 'clauses'), [('def', 'newc', ('call', ('var', 'subst_clause'), [('var', 'c'), ('var', 'slist')])), ('exp', ('call', ('var', 'append'), [('var', 'newclist'), ('var', 'newc')]))]), ('exp', ('var', 'newclist'))])), ('def', 'merge', ('lambda', ['mgu1', 'mgu2'], [('if', ('||', ('==', ('var', 'mgu1'), ('null',)), ('==', ('var', 'mgu2'), ('null',))), [('exp', ('null',))], [('def', 'res', ('var', 'mgu1')), ('for', 'x', ('var', 'mgu2'), [('exp', ('call', ('var', 'append'), [('var', 'res'), ('var', 'x')]))]), ('exp', ('var', 'res'))])])), ('def', 'unify', ('lambda', ['clause1', 'clause2'], [('if', ('||', ('!=', ('get', ('var', 'clause1'), ('string-lit', 'name')), ('get', ('var', 'clause2'), ('string-lit', 'name'))), ('!=', ('len', ('var', 'clause1')), ('len', ('var', 'clause2')))), [('exp', ('null',))], [('def', 'res', ('dict-lit', [])), ('def', 'i', ('int-lit', 0)), ('while', ('<', ('var', 'i'), ('len', ('var', 'clause1'))), [('def', 'term1', ('call', ('var', 'subst_term'), [('get', ('var', 'clause1'), ('var', 'i')), ('var', 'res')])), ('def', 'term2', ('call', ('var', 'subst_term'), [('get', ('var', 'clause2'), ('var', 'i')), ('var', 'res')])), ('if', ('&&', ('&&', ('call', ('var', 'isCst'), [('var', 'term1')]), ('call', ('var', 'isCst'), [('var', 'term2')])), ('==', ('get', ('var', 'term1'), ('string-lit', 'name')), ('get', ('var', 'term2'), ('string-lit', 'name')))), [], [('if', ('&&', ('call', ('var', 'isVar'), [('var', 'term1')]), ('||', ('call', ('var', 'not'), [('call', ('var', 'contains'), [('var', 'term2'), ('get', ('var', 'term1'), ('string-lit', 'name'))])]), ('call', ('var', 'isVar'), [('var', 'term2')]))), [('def', 's', ('dict-lit', [('from', ('get', ('var', 'term1'), ('string-lit', 'name'))), ('to', ('call', ('var', 'subst_term'), [('var', 'term2'), ('var', 'res')]))])), ('exp', ('call', ('var', 'append'), [('var', 'res'), ('var', 's')]))], [('if', ('&&', ('call', ('var', 'isVar'), [('var', 'term2')]), ('||', ('call', ('var', 'not'), [('call', ('var', 'contains'), [('var', 'term1'), ('get', ('var', 'term2'), ('string-lit', 'name'))])]), ('call', ('var', 'isVar'), [('var', 'term1')]))), [('def', 's', ('dict-lit', [('from', ('get', ('var', 'term2'), ('string-lit', 'name'))), ('to', ('call', ('var', 'subst_term'), [('var', 'term1'), ('var', 'res')]))])), ('exp', ('call', ('var', 'append'), [('var', 'res'), ('var', 's')]))], [('if', ('&&', ('call', ('var', 'isClause'), [('var', 'term1')]), ('call', ('var', 'isClause'), [('var', 'term2')])), [('def', 'innermgu', ('call', ('var', 'unify'), [('get', ('var', 'term1'), ('string-lit', 'ref')), ('get', ('var', 'term2'), ('string-lit', 'ref'))])), ('if', ('==', ('var', 'innermgu'), ('null',)), [('asgn', 'i', ('len', ('var', 'clause1'))), ('asgn', 'res', ('null',))], [('exp', ('call', ('var', 'merge'), [('var', 'res'), ('var', 'innermgu')]))])], [('asgn', 'i', ('len', ('var', 'clause1'))), ('asgn', 'res', ('null',))])])])]), ('asgn', 'i', ('+', ('var', 'i'), ('int-lit', 1)))]), ('exp', ('var', 'res'))])])), ('def', 'process', ('lambda', ['goal'], [('def', 'negation', ('lambda', ['goal'], [('def', 'newgoal', ('dict-lit', [('name', ('get', ('var', 'goal'), ('string-lit', 'name'))), ('negated', ('var', 'False'))])), ('for', 'term', ('var', 'goal'), [('exp', ('call', ('var', 'append'), [('var', 'newgoal'), ('var', 'term')]))]), ('if', ('==', ('resume', ('coroutine', ('var', 'process')), ('var', 'newgoal')), ('null',)), [('exp', ('yield', ('dict-lit', [])))], None), ('exp', ('null',))])), ('def', 'conjunction', ('lambda', ['clauses', 'mgus', 'depth'], [('def', 'goal', ('get', ('var', 'clauses'), ('var', 'depth'))), ('def', 'solutions', ('call', ('var', 'wrap'), [('var', 'process'), ('var', 'goal')])), ('for', 'mgu', ('var', 'solutions'), [('if', ('==', ('var', 'depth'), ('-', ('len', ('var', 'clauses')), ('int-lit', 1))), [('exp', ('yield', ('call', ('var', 'merge'), [('var', 'mgu'), ('var', 'mgus')])))], [('exp', ('call', ('var', 'conjunction'), [('call', ('var', 'subst'), [('var', 'clauses'), ('var', 'mgu')]), ('call', ('var', 'merge'), [('var', 'mgu'), ('var', 'mgus')]), ('+', ('var', 'depth'), ('int-lit', 1))]))])]), ('exp', ('null',))])), ('if', ('get', ('var', 'goal'), ('string-lit', 'negated')), [('exp', ('call', ('var', 'negation'), [('var', 'goal')]))], [('for', 'rule', ('var', 'prog'), [('def', 'mgu', ('call', ('var', 'unify'), [('get', ('var', 'rule'), ('string-lit', 'head')), ('var', 'goal')])), ('if', ('!=', ('var', 'mgu'), ('null',)), [('if', ('==', ('get', ('var', 'rule'), ('string-lit', 'body')), ('null',)), [('exp', ('yield', ('var', 'mgu')))], [('def', 'partialMgus', ('call', ('var', 'wrap'), [('lambda', ['_'], [('exp', ('call', ('var', 'conjunction'), [('call', ('var', 'subst'), [('get', ('var', 'rule'), ('string-lit', 'body')), ('var', 'mgu')]), ('dict-lit', []), ('int-lit', 0)]))]), ('null',)])), ('for', 'm', ('var', 'partialMgus'), [('exp', ('yield', ('call', ('var', 'merge'), [('var', 'm'), ('var', 'mgus')])))])])], None)]), ('exp', ('null',))])])), ('def', 'co', ('coroutine', ('var', 'process'))), ('def', 'i', ('int-lit', 1)), ('print', ('+', ('string-lit', 'Asking for solution '), ('var', 'i'))), ('def', 's', ('resume', ('var', 'co'), ('var', 'query'))), ('print', ('+', ('string-lit', 'Answer: '), ('var', 's'))), ('while', ('!=', ('var', 's'), ('null',)), [('asgn', 'i', ('+', ('var', 'i'), ('int-lit', 1))), ('print', ('+', ('string-lit', 'Asking for solution '), ('var', 'i'))), ('asgn', 's', ('resume', ('var', 'co'), ('var', 'query'))), ('print', ('+', ('string-lit', 'Answer: '), ('var', 's')))])]
